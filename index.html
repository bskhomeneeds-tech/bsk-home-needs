<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bsk Home Needs</title>
    <style>
        :root { --primary:#28a745; --light:#f4f7f6; }
        body{margin:0;font-family:'Segoe UI',Arial,sans-serif;background:var(--light);padding-bottom:80px;}
        header{background:var(--primary);color:#fff;padding:15px;text-align:center;position:sticky;top:0;z-index:1000;}
        .page{display:none;padding:15px;animation:fadeIn 0.3s;}
        .active{display:block}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .card{background:#fff;padding:12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.06);text-align:center;position:relative}
        .card img{width:100%;height:110px;object-fit:cover;border-radius:8px;}
        .badge{position:absolute;top:5px;right:5px;background:orange;color:#fff;font-size:10px;padding:2px 6px;border-radius:5px;}
        .btn{padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;width:100%;margin-top:8px;}
        .btn-main{background:var(--primary);color:#fff}
        .input-f{width:100%;padding:12px;margin:8px 0;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;}
        .nav{position:fixed;bottom:0;width:100%;background:#fff;display:flex;justify-content:space-around;padding:12px 0;border-top:1px solid #eee;z-index:1000}
        .nav-btn{background:none;border:none;font-size:12px;color:#666;cursor:pointer}
        .price-tag{color:var(--primary); font-weight:bold; font-size:18px}
        .del-tag{font-size:11px; color:#777}
    </style>
</head>
<body>

<header><h3 style="margin:0">Bsk Home Needs</h3></header>

<div id="home" class="page active">
    <input type="text" id="search-q" class="input-f" placeholder="üîç Search products..." onkeyup="doSearch()">
    <div id="product-grid" class="grid">‚òÅÔ∏è Loading products from cloud...</div>
</div>

<div id="cart" class="page">
    <h3>üõí My Bucket</h3>
    <div id="bucket-list"></div>
    <div id="checkout-box" style="display:none; background:#fff; padding:15px; border-radius:12px; margin-top:15px;">
        <h4>Checkout Details</h4>
        <input id="ord-name" class="input-f" placeholder="Recipient Name">
        <input id="ord-addr" class="input-f" placeholder="Full Delivery Address">
        <div id="bill-details" style="border-top:1px dashed #ccc; padding-top:10px; margin-top:10px;"></div>
        <button class="btn btn-main" onclick="confirmOrder()">Send WhatsApp Order üöÄ</button>
    </div>
</div>

<div id="admin" class="page">
    <div id="admin-login">
        <h3>Admin Panel</h3>
        <input id="pass-in" class="input-f" type="password" placeholder="Password">
        <button class="btn btn-main" onclick="adminLogin()">Login</button>
    </div>
    <div id="admin-panel" style="display:none">
        <h4>Add Product to Cloud</h4>
        <input id="p-name" class="input-f" placeholder="Product Name">
        <input id="p-price" class="input-f" type="number" placeholder="Price">
        <input id="p-del" class="input-f" type="number" placeholder="Delivery Fee">
        <input id="p-img" class="input-f" placeholder="Image URL">
        <button class="btn btn-main" id="pub-btn" onclick="saveToCloud()">Publish Live üöÄ</button>
        <hr>
        <h4>Live Inventory</h4>
        <div id="admin-list"></div>
    </div>
</div>

<div id="about" class="page">
    <div style="background:#fff; padding:20px; border-radius:12px; text-align:center">
        <h3>Contact Support</h3>
        <p>üìß <b>bskhomeneeds@gmail.com</b></p>
        <hr>
        <div id="user-info">
            <h4>üë§ Create ID</h4>
            <input id="u-name" class="input-f" placeholder="Your Name">
            <input id="u-phone" class="input-f" placeholder="WhatsApp Number">
            <button class="btn btn-main" onclick="saveProfile()">Save ID</button>
        </div>
        <div id="profile-active" style="display:none">
            <p id="p-welcome" style="color:green; font-weight:bold"></p>
            <button class="btn" style="border:1px solid #ddd" onclick="logout()">Logout</button>
        </div>
    </div>
</div>

<div class="nav">
    <button class="nav-btn" onclick="show('home')">üè†<br>Home</button>
    <button class="nav-btn" onclick="show('cart')">üõí<br>Bucket</button>
    <button class="nav-btn" onclick="show('admin')">üë§<br>Admin</button>
    <button class="nav-btn" onclick="show('about')">‚ÑπÔ∏è<br>Account</button>
</div>

<script>
// Cloud Database Configuration
const DB_NAME = "bsk_official_store_v2";
const API = `https://kvdb.io/${DB_NAME}/inventory`;

let state = { products: [], cart: [] };

async function init() {
    // Load User Profile
    const saved = localStorage.getItem("bsk_user");
    if(saved) {
        const user = JSON.parse(saved);
        document.getElementById("user-info").style.display = "none";
        document.getElementById("profile-active").style.display = "block";
        document.getElementById("p-welcome").innerText = "Logged in as: " + user.name;
    }
    await syncCloud();
}

async function syncCloud() {
    try {
        const res = await fetch(API + "?v=" + Date.now());
        if(res.ok) {
            state.products = await res.json();
            // Seed defaults if empty
            if(state.products.length === 0) {
                const seed = [
                    {name:"American Onion Style", price:5, del:2, img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_p6v9_Yw9vD4_jB9G_X-W8-eR_S0X_X_X_A&s"},
                    {name:"Lays Magic Masala", price:5, del:2, img:"https://m.media-amazon.com/images/I/718nSAtu6SL._SL1500_.jpg"}
                ];
                await fetch(API, {method:"POST", body:JSON.stringify(seed)});
                state.products = seed;
            }
        }
    } catch(e) { console.error("Sync Error"); }
    renderHome();
}

function renderHome(data = state.products) {
    const grid = document.getElementById("product-grid");
    grid.innerHTML = "";
    data.forEach((p, i) => {
        grid.innerHTML += `
        <div class="card">
            <span class="badge">Live</span>
            <img src="${p.img}" onerror="this.src='https://via.placeholder.com/150'">
            <div style="margin:5px 0"><b>${p.name}</b></div>
            <div class="price-tag">‚Çπ${p.price}</div>
            <div class="del-tag">+ ‚Çπ${p.del} Delivery</div>
            <button class="btn btn-main" onclick="addToBucket(${i})">Add to Bucket</button>
        </div>`;
    });
}

function addToBucket(i) {
    state.cart.push(state.products[i]);
    alert("Item added to bucket!");
    updateBucketUI();
}

function updateBucketUI() {
    const list = document.getElementById("bucket-list");
    const box = document.getElementById("checkout-box");
    const bill = document.getElementById("bill-details");
    list.innerHTML = "";
    
    let subtotal = 0, delivery = 0;
    
    state.cart.forEach((p, i) => {
        subtotal += Number(p.price);
        delivery += Number(p.del);
        list.innerHTML += `<div class="card" style="display:flex;justify-content:space-between;margin-bottom:5px"><span>${p.name} (‚Çπ${p.price})</span><button onclick="state.cart.splice(${i},1);updateBucketUI()" style="color:red;border:none;background:none">X</button></div>`;
    });

    bill.innerHTML = `<p>Items Total: ‚Çπ${subtotal}</p><p>Delivery Fee: ‚Çπ${delivery}</p><h3 style="color:var(--primary)">Grand Total: ‚Çπ${subtotal + delivery}</h3>`;
    box.style.display = state.cart.length ? "block" : "none";
}

function confirmOrder() {
    const name = document.getElementById("ord-name").value;
    const addr = document.getElementById("ord-addr").value;
    if(!name || !addr) return alert("Fill delivery info!");

    let msg = `*New Order - Bsk Home Needs*\n\n*Customer:* ${name}\n*Address:* ${addr}\n\n*Items:*\n`;
    let total = 0;
    state.cart.forEach(p => {
        msg += `- ${p.name} (‚Çπ${p.price})\n`;
        total += (Number(p.price) + Number(p.del));
    });
    msg += `\n*Final Total:* ‚Çπ${total}`;
    
    window.open(`https://wa.me/918011924700?text=${encodeURIComponent(msg)}`);
    state.cart = []; // Auto clear
    updateBucketUI();
}

async function saveToCloud() {
    const n = document.getElementById("p-name").value;
    const p = document.getElementById("p-price").value;
    const d = document.getElementById("p-del").value || 0;
    const i = document.getElementById("p-img").value;
    
    if(!n || !p || !i) return alert("Fill all details!");
    
    state.products.push({name:n, price:p, del:d, img:i});
    await fetch(API, {method:"POST", body:JSON.stringify(state.products)});
    alert("Cloud Updated! Product is now LIVE.");
    location.reload();
}

function adminLogin() {
    if(document.getElementById("pass-in").value === "Bhashkar business") {
        document.getElementById("admin-login").style.display = "none";
        document.getElementById("admin-panel").style.display = "block";
        renderAdminList();
    }
}

function renderAdminList() {
    const list = document.getElementById("admin-list");
    list.innerHTML = "";
    state.products.forEach((p, i) => {
        list.innerHTML += `<div style="display:flex;justify-content:space-between;padding:10px;background:#fff;margin-bottom:5px;border-radius:8px"><span>${p.name}</span><button onclick="delItem(${i})" style="color:red">Delete</button></div>`;
    });
}

async function delItem(i) {
    if(!confirm("Remove from cloud?")) return;
    state.products.splice(i, 1);
    await fetch(API, {method:"POST", body:JSON.stringify(state.products)});
    location.reload();
}

function saveProfile() {
    const n = document.getElementById("u-name").value;
    const ph = document.getElementById("u-phone").value;
    if(!n || !ph) return;
    localStorage.setItem("bsk_user", JSON.stringify({name:n, phone:ph}));
    location.reload();
}

function logout() { localStorage.removeItem("bsk_user"); location.reload(); }
function show(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}
function doSearch() {
    const q = document.getElementById("search-q").value.toLowerCase();
    renderHome(state.products.filter(p => p.name.toLowerCase().includes(q)));
}

window.onload = init;
</script>
</body>
</html>
