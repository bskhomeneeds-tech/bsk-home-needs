<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bsk Home Needs</title>
    <style>
        :root { --primary:#28a745; --light:#f4f7f6; }
        body{margin:0;font-family:Segoe UI,Arial;background:var(--light);padding-bottom:75px}
        header{background:var(--primary);color:#fff;padding:15px;text-align:center;position:sticky;top:0;z-index:1000}
        .page{display:none;padding:15px}
        .active{display:block}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .card{background:#fff;padding:10px;border-radius:12px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.06); margin-bottom: 10px;}
        .card img{width:100%;height:110px;object-fit:cover;border-radius:8px; background: #eee;}
        .btn{padding:12px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;width:100%;margin-top:6px}
        .btn-main{background:var(--primary);color:#fff}
        .btn-outline{border:1px solid var(--primary);background:none;color:var(--primary)}
        .input-f{width:100%;padding:12px;margin:8px 0;border:1px solid #ddd;border-radius:8px; box-sizing: border-box;}
        .nav{position:fixed;bottom:0;width:100%;background:#fff;display:flex;justify-content:space-around;padding:10px 0;border-top:1px solid #ddd}
        .nav-btn{background:none;border:none;font-size:11px;cursor:pointer}
        .search-box { display: flex; gap: 5px; margin-bottom: 15px; }
        .search-box input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
    </style>
</head>
<body>

<header>
    <h3 style="margin:0">Bsk Home Needs</h3>
</header>

<div id="home" class="page active">
    <div class="search-box">
        <input type="text" id="search-input" placeholder="Search products..." onkeyup="doSearch()">
        <button class="btn-main" style="width:auto; padding:0 15px;">üîç</button>
    </div>
    <div id="product-grid" class="grid">Loading Products...</div>
</div>

<div id="cart" class="page">
    <h3>üõí My Bucket</h3>
    <div id="bucket-items"></div>
    <div id="checkout" style="display:none; background:white; padding:15px; border-radius:10px; margin-top:10px;">
        <h4 id="total-price" style="margin:0 0 10px 0;">Total: ‚Çπ0</h4>
        <button class="btn btn-main" onclick="confirmOrder()">Confirm Order (WhatsApp)</button>
    </div>
</div>

<div id="admin" class="page">
    <div id="admin-login-area">
        <input id="a-pass" class="input-f" type="password" placeholder="Admin Password">
        <button class="btn btn-main" onclick="adminLogin()">Login Admin</button>
    </div>
    <div id="admin-panel" style="display:none">
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button class="btn btn-main" onclick="toggleAdminView('add')">Add Product</button>
            <button class="btn btn-outline" onclick="toggleAdminView('list')">Unlist Items</button>
        </div>
        <div id="admin-add" style="display:none">
            <input id="p-name" class="input-f" placeholder="Product Name">
            <input id="p-price" class="input-f" type="number" placeholder="Price">
            <input id="p-del" class="input-f" type="number" placeholder="Delivery Charge">
            <input id="p-img" class="input-f" placeholder="Image URL">
            <button class="btn btn-main" id="save-btn" onclick="saveProduct()">PUBLISH LIVE</button>
        </div>
        <div id="admin-list" style="display:none"></div>
    </div>
</div>

<div id="profile" class="page">
    <div style="background:white; padding:20px; border-radius:10px; text-align:center;">
        <h3>Contact Us</h3>
        <p>üìß Email: <b>bskhomeneeds@gmail.com</b></p>
    </div>
    <hr>
    <div id="login-section">
        <h3>Customer Login</h3>
        <input id="u-name" class="input-f" placeholder="Full Name">
        <input id="u-phone" class="input-f" placeholder="Phone Number">
        <button class="btn btn-main" onclick="register()">Save Details</button>
    </div>
    <div id="logout-section" style="display:none">
        <button class="btn btn-outline" onclick="logout()">Logout Account</button>
    </div>
</div>

<div class="nav">
    <button class="nav-btn" onclick="show('home')">üè†<br>Home</button>
    <button class="nav-btn" onclick="show('cart')">üõí<br>Bucket</button>
    <button class="nav-btn" onclick="show('admin')">üë§<br>Admin</button>
    <button class="nav-btn" onclick="show('profile')">üìû<br>Contact</button>
</div>

<script>
const DB_ID = "bsk_final_2026_live"; 
const API = k => `https://kvdb.io/${DB_ID}/${k}`;

let state = { products: [], cart: [], user: null };

async function init() {
    const u = localStorage.getItem("bsk_user");
    if(u) {
        state.user = JSON.parse(u);
        document.getElementById("login-section").style.display = "none";
        document.getElementById("logout-section").style.display = "block";
    }
    await sync();
}

async function sync() {
    try {
        const p = await fetch(API("inventory"));
        state.products = p.ok ? await p.json() : [];
        renderHome();
    } catch(e) { document.getElementById("product-grid").innerHTML = "Connection Error."; }
}

function renderHome(data = state.products) {
    const g = document.getElementById("product-grid");
    g.innerHTML = data.length ? "" : "No products available.";
    data.forEach((p, i) => {
        g.innerHTML += `
        <div class="card">
            <img src="${p.img}" onerror="this.src='https://via.placeholder.com/150'">
            <b>${p.name}</b><br>
            ‚Çπ${p.price} <small>(Del: ‚Çπ${p.del})</small>
            <button class="btn btn-main" onclick="addToCart(${i})">Add üõí</button>
        </div>`;
    });
}

function doSearch() {
    const q = document.getElementById("search-input").value.toLowerCase();
    const filtered = state.products.filter(p => p.name.toLowerCase().includes(q));
    renderHome(filtered);
}

function addToCart(i) {
    state.cart.push(state.products[i]);
    alert("Added to Bucket!");
    renderCart();
}

function renderCart() {
    const d = document.getElementById("bucket-items");
    d.innerHTML = state.cart.length ? "" : "Your bucket is empty.";
    let total = 0;
    state.cart.forEach((p, i) => {
        total += Number(p.price) + Number(p.del);
        d.innerHTML += `<div class="card" style="text-align:left; display:flex; justify-content:space-between; align-items:center;">
            <span>${p.name} (‚Çπ${p.price})</span>
            <button onclick="removeFromCart(${i})" style="color:red; background:none; border:none;">‚ùå</button>
        </div>`;
    });
    document.getElementById("total-price").innerText = "Total: ‚Çπ" + total;
    document.getElementById("checkout").style.display = state.cart.length ? "block" : "none";
}

function removeFromCart(i) {
    state.cart.splice(i, 1);
    renderCart();
}

function confirmOrder() {
    if(!state.user) { alert("Please login in Contact section first!"); return show('profile'); }
    let msg = `New Order from ${state.user.name} (${state.user.phone}):\n`;
    state.cart.forEach(p => msg += `- ${p.name} (‚Çπ${p.price})\n`);
    msg += `Total Payable: ${document.getElementById("total-price").innerText}`;
    window.open(`https://wa.me/918011924700?text=${encodeURIComponent(msg)}`, '_blank');
}

async function saveProduct() {
    const name = document.getElementById("p-name").value;
    const price = document.getElementById("p-price").value;
    const del = document.getElementById("p-del").value || 0;
    const img = document.getElementById("p-img").value;
    if(!name || !price || !img) return alert("Fill Name, Price and Image URL!");

    document.getElementById("save-btn").innerText = "Publishing...";
    state.products.push({ name, price, del, img });
    await fetch(API("inventory"), { method: "POST", body: JSON.stringify(state.products) });
    alert("Product added successfully!");
    location.reload();
}

function adminLogin() {
    if(document.getElementById("a-pass").value === "Bhashkar business") {
        document.getElementById("admin-login-area").style.display = "none";
        document.getElementById("admin-panel").style.display = "block";
    } else alert("Wrong password");
}

function toggleAdminView(v) {
    document.getElementById("admin-add").style.display = v === 'add' ? "block" : "none";
    document.getElementById("admin-list").style.display = v === 'list' ? "block" : "none";
    if(v === 'list') renderAdminList();
}

function renderAdminList() {
    const d = document.getElementById("admin-list");
    d.innerHTML = "<h3>Inventory List</h3>";
    state.products.forEach((p, i) => {
        d.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <span>${p.name}</span>
            <button onclick="deleteProduct(${i})" style="color:red; background:none; border:none; cursor:pointer;">Delete ‚ùå</button>
        </div>`;
    });
}

async function deleteProduct(i) {
    if(!confirm("Delete this product?")) return;
    state.products.splice(i, 1);
    await fetch(API("inventory"), { method: "POST", body: JSON.stringify(state.products) });
    renderAdminList();
    renderHome();
}

function show(id) {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add('active');
    if(id === 'cart') renderCart();
}

function register() {
    const name = document.getElementById("u-name").value;
    const phone = document.getElementById("u-phone").value;
    if(!name || !phone) return alert("Fill all details");
    localStorage.setItem("bsk_user", JSON.stringify({name, phone}));
    location.reload();
}

function logout() { localStorage.removeItem("bsk_user"); location.reload(); }

window.onload = init;
</script>
</body>
</html>
