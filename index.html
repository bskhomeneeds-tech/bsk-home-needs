<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bsk home needs</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
        header { background-color: #007bff; color: white; padding: 10px; text-align: center; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .search-bar { margin-bottom: 20px; text-align: center; }
        .search-bar input { padding: 10px; width: 300px; }
        .search-bar button { padding: 10px; background-color: #28a745; color: white; border: none; cursor: pointer; }
        .products { display: flex; flex-wrap: wrap; gap: 20px; }
        .product { background: white; padding: 15px; border: 1px solid #ddd; border-radius: 5px; width: 200px; text-align: center; }
        .product img { width: 100%; height: 150px; object-fit: cover; }
        .product button { margin-top: 10px; padding: 5px 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        .icons { position: fixed; bottom: 10px; left: 10px; display: flex; gap: 20px; }
        .icon { font-size: 24px; cursor: pointer; padding: 10px; background: white; border-radius: 50%; box-shadow: 0 0 5px rgba(0,0,0,0.3); }
        .hidden { display: none; }
        .login-form, .admin-form, .order-form, .add-product-form { background: white; padding: 20px; border: 1px solid #ddd; border-radius: 5px; max-width: 400px; margin: 20px auto; }
        .login-form input, .admin-form input, .order-form input, .order-form textarea, .add-product-form input { display: block; width: 100%; margin-bottom: 10px; padding: 10px; }
        .login-form button, .admin-form button, .order-form button, .add-product-form button { padding: 10px; background-color: #28a745; color: white; border: none; cursor: pointer; width: 100%; }
        .admin-panel { margin-top: 20px; }
        .admin-panel .product { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .orders { max-height: 400px; overflow-y: scroll; }
        .order { background: white; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; }
        .bucket-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .back-btn { margin-top: 10px; padding: 10px; background-color: #dc3545; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <header>
        <h1>Bsk home needs</h1>
    </header>
    <div class="container">
        <!-- Login Page -->
        <div id="login-page">
            <div class="login-form">
                <h2>Login</h2>
                <input type="text" id="phone" placeholder="Phone Number (10 digits)" maxlength="10" pattern="[0-9]{10}" required>
                <input type="password" id="password" placeholder="Password" required>
                <button onclick="login()">Login</button>
            </div>
        </div>

        <!-- Home Page -->
        <div id="home-page" class="hidden">
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search products...">
                <button onclick="searchProduct()">Search</button>
            </div>
            <div id="search-result" class="hidden">
                <!-- Search result will be shown here -->
                <button class="back-btn" onclick="clearSearch()">Back to Home</button>
            </div>
            <div class="products" id="products-list">
                <!-- Products will be loaded here -->
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact-page" class="hidden">
            <h2>Contact Us</h2>
            <p>Email: bskhomeneeds@gmail.com</p>
            <button class="back-btn" onclick="showPage('home-page')">Back to Home</button>
        </div>

        <!-- Admin Page -->
        <div id="admin-page" class="hidden">
            <div class="admin-form">
                <h2>Admin Login</h2>
                <input type="password" id="admin-password" placeholder="Password" required>
                <button onclick="adminLogin()">Login</button>
            </div>
            <div id="admin-panel" class="hidden">
                <h2>Admin Panel</h2>
                <button onclick="showAddProductForm()">Add Product</button>
                <div id="add-product-form" class="hidden add-product-form">
                    <h3>Add New Product</h3>
                    <input type="text" id="product-name" placeholder="Product Name" required>
                    <input type="number" id="product-price" placeholder="Price in ‚Çπ" required>
                    <input type="number" id="product-delivery" placeholder="Delivery Charge in ‚Çπ" required>
                    <input type="file" id="product-image" accept="image/*" required>
                    <button onclick="addProduct()">Submit</button>
                    <button class="back-btn" onclick="hideAddProductForm()">Cancel</button>
                </div>
                <h3>Manage Products</h3>
                <div id="admin-products"></div>
                <h3>Orders</h3>
                <div class="orders" id="admin-orders">
                    <!-- Orders will be loaded here -->
                </div>
                <button class="back-btn" onclick="showPage('home-page')">Back to Home</button>
            </div>
        </div>

        <!-- Bucket Page -->
        <div id="bucket-page" class="hidden">
            <h2>Your Bucket</h2>
            <div id="bucket-items"></div>
            <button onclick="showOrderForm()">Order All</button>
            <button class="back-btn" onclick="showPage('home-page')">Back to Home</button>
        </div>

        <!-- Order Form -->
        <div id="order-form" class="hidden">
            <div class="order-form">
                <h2>Place Order</h2>
                <input type="text" id="order-name" placeholder="Name" required>
                <input type="text" id="order-phone" placeholder="Phone Number (10 digits)" maxlength="10" pattern="[0-9]{10}" required>
                <textarea id="order-address" placeholder="Address" required></textarea>
                <div id="order-summary"></div>
                <button onclick="placeOrder()">Place Order</button>
                <button class="back-btn" onclick="showPage('bucket-page')">Back</button>
            </div>
        </div>

        <!-- My Orders Page -->
        <div id="my-orders-page" class="hidden">
            <h2>My Orders</h2>
            <div id="my-orders-list"></div>
            <button class="back-btn" onclick="showPage('home-page')">Back to Home</button>
        </div>
    </div>

    <!-- Icons at Bottom Left -->
    <div class="icons">
        <div class="icon" onclick="showPage('contact-page')">‚úâÔ∏è</div>
        <div class="icon" onclick="showPage('admin-page')">üë§</div>
        <div class="icon" onclick="showPage('bucket-page')">üõí</div>
        <div class="icon" onclick="showPage('my-orders-page')">üéí</div>
    </div>

    <script>
        // Load data from localStorage or initialize empty
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let orders = JSON.parse(localStorage.getItem('orders')) || [];
        let bucket = [];
        let loggedIn = false;
        let userPhone = '';

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('orders', JSON.stringify(orders));
        }

        // Check if logged in on load
        window.onload = function() {
            if (localStorage.getItem('loggedIn') === 'true') {
                loggedIn = true;
                userPhone = localStorage.getItem('userPhone');
                showPage('home-page');
                loadProducts();
            } else {
                showPage('login-page');
            }
        };

        function showPage(pageId) {
            document.querySelectorAll('.container > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            if (pageId === 'bucket-page') loadBucket();
            if (pageId === 'my-orders-page') loadMyOrders();
            if (pageId === 'admin-panel') {
                loadAdminProducts();
                loadAdminOrders(); // Immediate load
            }
        }

        function login() {
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            if (phone.length === 10 && /^\d+$/.test(phone) && password) {
                loggedIn = true;
                userPhone = phone;
                localStorage.setItem('loggedIn', 'true');
                localStorage.setItem('userPhone', phone);
                showPage('home-page');
                loadProducts();
            } else {
                alert('Invalid phone or password');
            }
        }

        function loadProducts() {
            const list = document.getElementById('products-list');
            list.innerHTML = '';
            products.filter(p => p.listed).forEach(p => {
                list.innerHTML += `
                    <div class="product">
                        <img src="${p.image}" alt="${p.name}">
                        <h3>${p.name}</h3>
                        <p>‚Çπ${p.price}</p>
                        <input type="number" id="qty-${p.id}" min="1" value="1">
                        <button onclick="addToBucket(${p.id})">Add to Bucket</button>
                        <button onclick="orderNow(${p.id})">Order Now</button>
                    </div>
                `;
            });
        }

        function addToBucket(id) {
            const qty = parseInt(document.getElementById(`qty-${id}`).value);
            if (qty > 0) {
                const product = products.find(p => p.id === id);
                bucket.push({ ...product, qty });
                alert('Added to bucket');
            }
        }

        function orderNow(id) {
            const qty = parseInt(document.getElementById(`qty-${id}`).value);
            if (qty > 0) {
                const product = products.find(p => p.id === id);
                bucket = [{ ...product, qty }];
                showOrderForm();
            }
        }

        function searchProduct() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const result = document.getElementById('search-result');
            const found = products.find(p => p.name.toLowerCase() === query && p.listed);
            if (found) {
                result.innerHTML = `
                    <div class="product">
                        <img src="${found.image}" alt="${found.name}">
                        <h3>${found.name}</h3>
                        <p>‚Çπ${found.price}</p>
                        <input type="number" id="search-qty" min="1" value="1">
                        <button onclick="addToBucket(${found.id})">Add to Bucket</button>
                        <button onclick="orderNow(${found.id})">Order Now</button>
                    </div>
                    <button class="back-btn" onclick="clearSearch()">Back to Home</button>
                `;
            } else {
                result.innerHTML = '<p>This product is not available</p><button class="back-btn" onclick="clearSearch()">Back to Home</button>';
            }
            result.classList.remove('hidden');
            document.getElementById('products-list').classList.add('hidden');
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('search-result').classList.add('hidden');
            document.getElementById('products-list').classList.remove('hidden');
        }

        function adminLogin() {
            const pwd = document.getElementById('admin-password').value;
            if (pwd === 'Bhashkar business') {
                document.getElementById('admin-panel').classList.remove('hidden');
                document.querySelector('.admin-form').classList.add('hidden');
                loadAdminProducts();
                loadAdminOrders(); // Immediate load
            } else {
                alert('Wrong password');
            }
        }

        function showAddProductForm() {
            document.getElementById('add-product-form').classList.remove('hidden');
        }

        function hideAddProductForm() {
            document.getElementById('add-product-form').classList.add('hidden');
        }

        function addProduct() {
            const name = document.getElementById('product-name').value;
            const price = parseInt(document.getElementById('product-price').value);
            const deliveryCharge = parseInt(document.getElementById('product-delivery').value);
            const file = document.getElementById('product-image').files[0];
            if (name && price && deliveryCharge && file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const image = e.target.result;
                    products.push({ id: products.length + 1, name, price, deliveryCharge, image, listed: true });
                    saveData(); // Save after adding
                    loadProducts();
                    loadAdminProducts();
                    hideAddProductForm();
                    alert('Product added successfully!');
                };
                reader.readAsDataURL(file);
            } else {
                alert('Fill all fields');
            }
        }

        function loadAdminProducts() {
            const list = document.getElementById('admin-products');
            list.innerHTML = '';
            products.forEach(p => {
                list.innerHTML += `
                    <div class="product">
                        <img src="${p.image}" alt="${p.name}" style="width:50px; height:50px;">
                        <span>${p.name} - ‚Çπ${p.price} (Delivery: ‚Çπ${p.deliveryCharge})</span>
                        <button onclick="toggleList(${p.id})">${p.listed ? 'Unlist' : 'List'}</button>
                    </div>
                `;
            });
        }

        function toggleList(id) {
            const product = products.find(p => p.id === id);
            product.listed = !product.listed;
            saveData(); // Save after toggle
            loadProducts();
            loadAdminProducts();
        }

        function loadAdminOrders() {
            const list = document.getElementById('admin-orders');
            list.innerHTML = '';
            if (orders.length === 0) {
                list.innerHTML = '<p>No orders yet.</p>';
            } else {
                orders.slice().reverse().forEach(o => { // New orders at top
                    list.innerHTML += `
                        <div class="order">
                            <p><strong>Order ID:</strong> ${o.id}</p>
                            <p><strong>Name:</strong> ${o.name}</p>
                            <p><strong>Phone:</strong> ${o.phone}</p>
                            <p><strong>Address:</strong> ${o.address}</p>
                            <p><strong>Items:</strong> ${o.items.map(i => `${i.name} x${i.qty}`).join(', ')}</p>
                            <p><strong>Total:</strong> ‚Çπ${o.total}</p>
                            <button onclick="cancelOrder(${o.id})">Cancel</button>
                        </div>
                    `;
                });
            }
        }

        function showOrderForm() {
            if (bucket.length > 0) {
                const total = bucket.reduce((sum, item) => sum + (item.price * item.qty), 0) + bucket[0].deliveryCharge;
                document.getElementById('order-summary').innerHTML = `<p>Total: ‚Çπ${total} (including delivery)</p>`;
                showPage('order-form');
            } else {
                alert('Bucket is empty');
            }
        }

        function placeOrder() {
            const name = document.getElementById('order-name').value;
            const phone = document.getElementById('order-phone').value;
            const address = document.getElementById('order-address').value;
            if (name && phone.length === 10 && /^\d+$/.test(phone) && address && bucket.length > 0) {
                const total = bucket.reduce((sum, item) => sum + (item.price * item.qty), 0) + bucket[0].deliveryCharge;
                const order = { id: orders.length + 1, name, phone, address, items: [...bucket], total };
                orders.push(order);
                saveData(); // Save after placing order
                bucket = [];
                alert('Order placed');
                showPage('home-page');
            } else {
                alert('Fill all details correctly');
            }
        }

        function cancelOrder(id) {
            orders = orders.filter(o => o.id !== id);
            saveData(); // Save after cancel
            loadAdminOrders();
            loadMyOrders();
        }

        function loadBucket() {
            const list = document.getElementById('bucket-items');
            list.innerHTML = '';
            bucket.forEach(item => {
                list.innerHTML += `<div class="bucket-item"><span>${item.name} x${item.qty} - ‚Çπ${item.price * item.qty}</span></div>`;
            });
        }

        function loadMyOrders() {
            const list = document.getElementById('my-orders-list');
            list.innerHTML = '';
            orders.filter(o => o.phone === userPhone).forEach(o => {
                list.innerHTML += `
                    <div class="order">
                        <p>Items: ${o.items.map(i => `${i.name} x${i.qty}`).join(', ')}</p>
                        <p>Total: ‚Çπ${o.total}</p>
                        <button onclick="cancelOrder(${o.id})">Cancel</button>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
