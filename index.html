<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BSK HOME NEEDS | FULL CATEGORIES</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #6366f1; --success: #10b981; --danger: #ef4444; --warning: #f59e0b; --glass: rgba(255, 255, 255, 0.98); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: 'Poppins', sans-serif; margin: 0; 
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%; animation: fastBG 15s ease infinite;
            padding-bottom: 110px; color: #1e293b;
        }
        @keyframes fastBG { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

        header { background: rgba(0,0,0,0.95); color: #fff; padding: 10px; text-align: center; position: sticky; top: 0; z-index: 1000; border-bottom: 3px solid var(--primary); height: 50px; display: flex; align-items: center; justify-content: center; }
        header h2 { margin: 0; font-size: 15px; letter-spacing: 2px; font-weight: 900; }

        .container { padding: 10px; max-width: 900px; margin: auto; }

        /* SCROLLABLE CATEGORIES */
        .cat-scroll { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0 20px 0; scrollbar-width: none; -webkit-overflow-scrolling: touch; }
        .cat-scroll::-webkit-scrollbar { display: none; }
        .cat-chip { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); color: #fff; padding: 8px 18px; border-radius: 20px; font-size: 11px; font-weight: 700; white-space: nowrap; border: 1px solid rgba(255,255,255,0.3); transition: 0.3s; }
        .cat-chip.active { background: var(--primary); border-color: var(--primary); transform: scale(1.1); }

        .product-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        .p-card { background: var(--glass); border-radius: 25px; padding: 15px; display: flex; flex-direction: column; height: 460px; justify-content: space-between; box-shadow: 0 10px 25px rgba(0,0,0,0.15); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .p-card:active { transform: scale(0.96); }

        .img-box { width: 100%; height: 140px; background: #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .img-box img { max-width: 80%; max-height: 80%; object-fit: contain; }

        .btn { border: none; padding: 14px; border-radius: 18px; font-weight: 800; cursor: pointer; font-size: 11px; text-transform: uppercase; width: 100%; transition: 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55); box-shadow: 0 8px 15px rgba(0,0,0,0.1); }
        .btn-cart { background: var(--warning); color: #fff; margin-bottom: 6px; }
        .btn-buy { background: var(--primary); color: #fff; }

        nav { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 92%; background: rgba(0,0,0,0.95); height: 75px; border-radius: 35px; display: flex; justify-content: space-around; align-items: center; z-index: 2000; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .nav-item { color: #94a3b8; text-align: center; font-size: 11px; font-weight: 600; cursor: pointer; }
        .nav-item.active { color: #fff; transform: translateY(-5px); }
        .nav-item b { font-size: 26px; display: block; }

        .page { display: none; }
        .page-active { display: block; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from {opacity:0; transform:translateY(30px)} to {opacity:1; transform:translateY(0)} }

        .glass-box { background: #fff; padding: 25px; border-radius: 35px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, textarea, select { width: 100%; padding: 15px; margin: 8px 0; border: 2px solid #f1f5f9; border-radius: 15px; font-family: inherit; }

        #order-modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index: 3000; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-card { background:#fff; width:92%; max-width:480px; padding:30px; border-radius:40px; }
    </style>
</head>
<body>

<header><h2>BSK HOME NEEDS</h2></header>

<div class="container">
    <div id="p-shop" class="page page-active">
        <input type="text" placeholder="üîé Search products..." oninput="doSearch(this.value)">
        
        <div class="cat-scroll" id="category-bar">
            <div class="cat-chip active" onclick="filterCat('All', this)">All Items</div>
            <div class="cat-chip" onclick="filterCat('Grocery', this)">Grocery üåæ</div>
            <div class="cat-chip" onclick="filterCat('Snacks', this)">Snacks ü•®</div>
            <div class="cat-chip" onclick="filterCat('Beverages', this)">Beverages ü•§</div>
            <div class="cat-chip" onclick="filterCat('Vegetables', this)">Vegetables ü•¶</div>
            <div class="cat-chip" onclick="filterCat('Dairy', this)">Dairy & Eggs ü•ö</div>
            <div class="cat-chip" onclick="filterCat('Personal Care', this)">Personal Care üß¥</div>
            <div class="cat-chip" onclick="filterCat('Home Care', this)">Home Care üßπ</div>
            <div class="cat-chip" onclick="filterCat('Unleash', this)">Unleash ‚ö°</div>
        </div>

        <div id="main-grid" class="product-grid">Connecting...</div>
    </div>

    <div id="p-cart" class="page">
        <div class="glass-box">
            <h3>My Cart üõí</h3>
            <div id="cart-ui-list">Empty</div>
            <hr style="opacity:0.1; margin:20px 0;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b>Total (Price+Del.):</b>
                <h2 id="total-price-ui" style="color:var(--success); margin:0;">‚Çπ0</h2>
            </div>
            <button class="btn btn-buy" style="height:65px; margin-top:25px;" onclick="checkout('cart')">CONFIRM ORDER</button>
        </div>
    </div>

    <div id="p-user" class="page">
        <div class="glass-box">
            <h3>My Profile üë§</h3>
            <input type="text" id="u-name" placeholder="Name">
            <input type="number" id="u-phone" placeholder="WhatsApp">
            <textarea id="u-addr" placeholder="Full Address" rows="3"></textarea>
            <button class="btn btn-buy" onclick="saveUser()">SAVE PROFILE</button>
        </div>
        <div class="glass-box" style="background:#000; color:#fff;">
            <h4>Admin Login</h4>
            <input type="password" id="admin-pin" placeholder="Enter PIN">
            <button class="btn" style="background:var(--primary); color:#fff;" onclick="checkAdmin()">LOGIN</button>
        </div>
    </div>

    <div id="p-admin" class="page">
        <div class="glass-box">
            <div style="display:flex; justify-content:space-between;"><h3>Add Product</h3> <button onclick="navigate('p-shop')" style="color:red; font-weight:900; background:none; border:none;">X</button></div>
            <input type="text" id="ad-n" placeholder="Name">
            <input type="number" id="ad-p" placeholder="Price (‚Çπ)">
            <input type="number" id="ad-d" placeholder="Per Item Delivery (‚Çπ)" value="0">
            <input type="text" id="ad-i" placeholder="Image URL">
            <select id="ad-c">
                <option value="Grocery">Grocery</option>
                <option value="Snacks">Snacks</option>
                <option value="Beverages">Beverages</option>
                <option value="Vegetables">Vegetables</option>
                <option value="Dairy">Dairy & Eggs</option>
                <option value="Personal Care">Personal Care</option>
                <option value="Home Care">Home Care</option>
                <option value="Unleash">Unleash</option>
            </select>
            <button class="btn btn-buy" onclick="addProduct()">‚ûï ADD TO STORE</button>
            <hr>
            <h4>Live Inventory (Unlist)</h4>
            <div id="admin-inventory-list"></div>
        </div>
    </div>
</div>

<div id="order-modal">
    <div class="modal-card">
        <h3>Order Summary ‚úÖ</h3>
        <div id="summary-list" style="background:#f8fafc; padding:15px; border-radius:20px; margin-bottom:15px; max-height:150px; overflow-y:auto; font-size:12px;"></div>
        <input type="text" id="fn" placeholder="Confirm Name">
        <input type="number" id="fp" placeholder="WhatsApp Number">
        <textarea id="fa" placeholder="Address" rows="2"></textarea>
        <button class="btn btn-buy" style="height:60px;" onclick="sendToWA()">üöÄ SEND TO WHATSAPP</button>
        <button class="btn" style="background:none; color:red;" onclick="closeM()">CANCEL</button>
    </div>
</div>

<nav>
    <div class="nav-item active" id="n-shop" onclick="navigate('p-shop', this)"><b>üè†</b>Store</div>
    <div class="nav-item" id="n-cart" onclick="navigate('p-cart', this)"><b>üõí</b>Cart</div>
    <div class="nav-item" id="n-user" onclick="navigate('p-user', this)"><b>üë§</b>User</div>
</nav>

<script>
    const _sb = supabase.createClient("https://lfxorgprrgpkkiqdjqdb.supabase.co", "sb_publishable_yyyMF6aEwhtYh4RHUFrIgA_OEU64IIX");
    let inventory = [], cart = [], curCheck = null;

    async function init() {
        const { data } = await _sb.from('inventory').select('*').order('created_at', {ascending:false});
        inventory = (data || []).map(p => ({...p, uq:1}));
        renderStore(inventory);
        loadLocal();
    }

    function renderStore(list) {
        document.getElementById('main-grid').innerHTML = list.map(p => `
            <div class="p-card">
                <div class="img-box"><img src="${p.image_url}"></div>
                <div style="text-align:center;">
                    <div style="font-weight:700; font-size:12px; margin:5px 0;">${p.name}<br><small style="color:var(--primary)">${p.category}</small></div>
                    <div style="color:var(--success); font-weight:900; font-size:22px;">‚Çπ${p.price}</div>
                    <div style="font-size:10px; color:#666">Delivery: ‚Çπ${p.delivery_charge}/pc</div>
                </div>
                <div>
                    <div style="display:flex; justify-content:space-between; align-items:center; background:#f1f5f9; border-radius:15px; padding:5px; margin-bottom:8px;">
                        <button style="width:35px; height:35px; border:none; background:#fff; border-radius:10px; font-weight:900;" onclick="updateQ(${p.id},-1)">-</button>
                        <b id="qv-${p.id}">${p.uq}</b>
                        <button style="width:35px; height:35px; border:none; background:#fff; border-radius:10px; font-weight:900;" onclick="updateQ(${p.id},1)">+</button>
                    </div>
                    <button class="btn btn-cart" onclick="addCart(${p.id})">Add Cart</button>
                    <button class="btn btn-buy" onclick="checkout(${p.id})">Buy Now</button>
                </div>
            </div>
        `).join('');
    }

    function updateQ(id, d) {
        const p = inventory.find(x => x.id === id);
        p.uq = Math.max(1, p.uq + d);
        document.getElementById(`qv-${id}`).innerText = p.uq;
    }

    function addCart(id) {
        const p = inventory.find(x => x.id === id);
        const ex = cart.find(c => c.id === id);
        if(ex) ex.fq += p.uq; else cart.push({...p, fq: p.uq});
        updateCartUI();
        alert("Added!");
    }

    function updateCartUI() {
        let total = 0; const ui = document.getElementById('cart-ui-list');
        if(!cart.length) ui.innerHTML = "Empty.";
        else {
            ui.innerHTML = cart.map((c, i) => {
                let itemTotal = (Number(c.price) + Number(c.delivery_charge || 0)) * c.fq;
                total += itemTotal;
                return `<div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #eee; font-size:12px;">
                    <span><b>${c.name}</b> (x${c.fq})</span>
                    <span>‚Çπ${itemTotal}</span>
                </div>`;
            }).join('');
        }
        document.getElementById('total-price-ui').innerText = "‚Çπ" + total;
    }

    function checkout(target) {
        curCheck = target;
        document.getElementById('fn').value = localStorage.getItem('un') || "";
        document.getElementById('fp').value = localStorage.getItem('up') || "";
        document.getElementById('fa').value = localStorage.getItem('ua') || "";
        let sum = "";
        if(target === 'cart') {
            cart.forEach(i => {
                let perUnit = Number(i.price) + Number(i.delivery_charge || 0);
                sum += `‚Ä¢ ${i.name} (x${i.fq}) = ‚Çπ${perUnit * i.fq}<br>`;
            });
        } else {
            const p = inventory.find(x => x.id === target);
            let perUnit = Number(p.price) + Number(p.delivery_charge || 0);
            sum = `‚Ä¢ ${p.name} (x${p.uq}) = ‚Çπ${perUnit * p.uq}`;
        }
        document.getElementById('summary-list').innerHTML = sum;
        document.getElementById('order-modal').style.display = 'flex';
    }

    function sendToWA() {
        const n = document.getElementById('fn').value, p = document.getElementById('fp').value, a = document.getElementById('fa').value;
        if(!n || !p || !a) return alert("Details missing!");
        localStorage.setItem('un', n); localStorage.setItem('up', p); localStorage.setItem('ua', a);
        
        let listMsg = "", grandTotal = 0;
        if(curCheck === 'cart') {
            cart.forEach((item, idx) => {
                let unitWithDel = Number(item.price) + Number(item.delivery_charge || 0);
                let sub = unitWithDel * item.fq;
                listMsg += `${idx+1}. *${item.name}*%0A   - Qty: ${item.fq}%0A   - Subtotal (incl. del): *‚Çπ${sub}*%0A%0A`;
                grandTotal += sub;
            });
            cart = []; updateCartUI();
        } else {
            const prod = inventory.find(x => x.id === curCheck);
            let unitWithDel = Number(prod.price) + Number(prod.delivery_charge || 0);
            grandTotal = unitWithDel * prod.uq;
            listMsg = `1. *${prod.name}*%0A   - Qty: ${prod.uq}%0A   - Total (incl. del): *‚Çπ${grandTotal}*%0A%0A`;
        }
        const msg = `üì¶ *NEW ORDER - BSK HOME NEEDS*%0A--------------------------------%0Aüë§ *Cust:* ${n}%0Aüìû *WA:* ${p}%0Aüìç *Addr:* ${a}%0A--------------------------------%0Aüõí *ITEMS (Delivery Included):*%0A%0A${listMsg}üí∞ *TOTAL: ‚Çπ${grandTotal}*%0A--------------------------------`;
        window.open(`https://api.whatsapp.com/send?phone=918011924700&text=${msg}`);
        closeM();
    }

    function navigate(id, el) { document.querySelectorAll('.page').forEach(p => p.classList.remove('page-active')); document.getElementById(id).classList.add('page-active'); if(el) { document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); el.classList.add('active'); } }
    function filterCat(cat, el) { document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active')); el.classList.add('active'); renderStore(cat === 'All' ? inventory : inventory.filter(p => p.category === cat)); }
    function checkAdmin() { if(document.getElementById('admin-pin').value === "Bhashkar jyoti Roy") { navigate('p-admin'); loadAdminList(); } else alert("Wrong!"); }
    async function addProduct() {
        const n = document.getElementById('ad-n').value, p = document.getElementById('ad-p').value, i = document.getElementById('ad-i').value, d = document.getElementById('ad-d').value, c = document.getElementById('ad-c').value;
        await _sb.from('inventory').insert([{name:n, price:p, image_url:i, delivery_charge:d, category:c}]);
        alert("Added!"); init(); loadAdminList();
    }
    async function loadAdminList() {
        const {data} = await _sb.from('inventory').select('*').order('created_at', {ascending:false});
        document.getElementById('admin-inventory-list').innerHTML = data.map(d => `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; font-size:12px; background:#fff; margin-bottom:5px;"><span>${d.name} (${d.category})</span> <button onclick="delP(${d.id})" style="color:red; border:none; background:none;">DEL</button></div>`).join('');
    }
    async function delP(id) { if(confirm("Delete?")) { await _sb.from('inventory').delete().eq('id', id); loadAdminList(); init(); } }
    function doSearch(q) { renderStore(inventory.filter(i => i.name.toLowerCase().includes(q.toLowerCase()))); }
    function closeM() { document.getElementById('order-modal').style.display = 'none'; }
    function saveUser() { localStorage.setItem('un', document.getElementById('u-name').value); localStorage.setItem('up', document.getElementById('u-phone').value); localStorage.setItem('ua', document.getElementById('u-addr').value); alert("Saved!"); }
    function loadLocal() { document.getElementById('u-name').value = localStorage.getItem('un') || ""; document.getElementById('u-phone').value = localStorage.getItem('up') || ""; document.getElementById('u-addr').value = localStorage.getItem('ua') || ""; }
    window.onload = init;
</script>
</body>
</html>
        
